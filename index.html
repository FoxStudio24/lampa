<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кино+  Главная</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Inserted Top 10 carousel styles (mobile-friendly) */
        .top10-container * { box-sizing: border-box; }
        .top10-container { background-color: rgba(0,0,0,0); color: #fff; }
        .top10-container .container { max-width: 100%; margin: 0 auto; padding: 20px 6px; }
        .top10-container h2 {
            font-size: 1.5rem;
            margin: 0 0 10px 20px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            font-family: 'textbold', sans-serif;
            z-index: 1;
            position: relative;
        }
        .carousel-wrapper { position: relative; margin: 0; }
        .carousel { display:flex; overflow-x:auto; overflow-y:visible; padding:10px 0; scroll-behavior:smooth; -webkit-overflow-scrolling: touch; }
        .carousel-track { display:flex; gap:12px; padding-left:12px; padding-right:12px; }
        
        .card {
            width: 140px;
            height: 210px;
            position: relative;
            transform: none; /* начальное положение без искажений */
            transform-style: preserve-3d;
            perspective: 900px;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            background: #ffffff00;
            flex-shrink: 0;
        }

        .poster-container {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            display: block;
            pointer-events: none;
            transform: translateZ(0);
            position: relative;
            overflow: hidden;
        }

        .poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            display: block;
            pointer-events: none;
        }

        /* Небольшой градиент в верхнем левом углу постера (под цифрой)(НАДО ПОТОМ КОГДА ПРИДУМАТЬ ЧТО-ТО ПОЛУЧШЕ) */
        .poster-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 120px;
            height: 120px;
            background: linear-gradient(to bottom right, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0) 40%, transparent 100%);
            z-index: 5;
            pointer-events: none;
        }

        .glare-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
            overflow: hidden;
            z-index: 10;
            pointer-events: none;
            mix-blend-mode: overlay;
            transform: translateZ(1px);
        }

        .glare-light {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(
                circle, 
                rgba(255, 255, 255, 0.8) 0%, 
                rgba(255, 255, 255, 0.4) 30%, 
                rgba(255, 255, 255, 0) 70%
            );
            transform: translate(-50%, -50%);
            opacity: 0;
            filter: blur(15px);
            transition: opacity .25s ease, left .08s linear, top .08s linear;
            will-change: left, top, opacity;
        }

        /* hover-подъём постера отключён — постер не масштабируется при наведении */

        .number {
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 40px;
            font-weight: 800;
            font-family: 'buttonbold', sans-serif;
            line-height: 1;
            z-index: 50;
            pointer-events: none;
            color: #ffffff;
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            mask-image: linear-gradient(to bottom, #ffffffd9 40%, transparent 100%);
            transform: translateZ(30px);
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0);
            will-change: transform;
            backface-visibility: visible;
            -webkit-text-stroke: 0.5px rgba(255, 255, 255, 0.3);
            text-rendering: geometricPrecision;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        @media (min-width: 768px) {
            .top10-container .container { padding: 50px 10px; }
            .carousel-wrapper { margin: 0; }
            .carousel-track { gap:20px; padding-left:40px; padding-right:40px; }
            .card { width:220px; height:330px; }
            .number { font-size: 80px; }
            .poster-container::before { width: 220px; height: 220px; }
        }
        
        /* Hero badge styles (big number in top-left with gradient under it) */
        .hero { position: relative; overflow: hidden; }
        .hero-badge { position: absolute; top: 18px; left: 18px; z-index: 60; pointer-events: none; }
        .hero-number {
            font-family: 'buttonbold', sans-serif;
            font-weight: 900;
            font-size: 120px;
            line-height: 0.9;
            color: #ffffff;
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            text-shadow: 0 6px 14px rgba(0,0,0,0.5);
            transform: translateZ(40px);
            will-change: transform;
        }
        /* Gradient under hero number (bigger, looks to bottom-right) */
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 300px;
            height: 300px;
            background: linear-gradient(to bottom right, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0) 40%, transparent 100%);
            border-top-left-radius: 12px; /* закругление в верхнем левом углу */
            z-index: 50;
            pointer-events: none;
        }
        @media (max-width: 767px) {
            .hero-badge { top: 12px; left: 12px; }
            .hero-number { font-size: 80px; transform: translateZ(30px); }
            .hero::before { width: 160px; height: 160px; }
        }
        /* Hero glare overrides (reuse existing .glare-overlay/.glare-light styles but tuned for hero) */
        .hero .glare-overlay { position: absolute; inset: 0; width: 100%; height: 100%; border-radius: inherit; z-index: 55; pointer-events: none; mix-blend-mode: overlay; overflow: hidden; }
        .hero .glare-light { width: 420px; height: 420px; filter: blur(24px); transition: opacity .28s ease, left .1s linear, top .1s linear; }
    </style>

</head>
<body>
        <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loader">
            <svg viewBox="0 0 80 80">
                <circle r="32" cy="40" cx="40" id="test"></circle>
            </svg>
        </div>

        <div class="loader triangle">
            <svg viewBox="0 0 86 80">
                <polygon points="43 8 79 72 7 72"></polygon>
            </svg>
        </div>

        <div class="loader">
            <svg viewBox="0 0 80 80">
                <rect height="64" width="64" y="8" x="8"></rect>
            </svg>
        </div>
    </div>
    <header class="header">
        <button class="search-trigger" id="search-trigger">
            <img src="ico/nav_mob/Поиск.svg" alt="Поиск" style="width: 24px; height: 24px;">
        </button>

        <nav class="nav-tabs">
    <a href="index.html">
        <img src="ico/nav_mob/Главная.svg" alt="Главная" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Главная
    </a>
    <a href="movies.html">
        <img src="ico/nav_mob/Фильмы.svg" alt="Фильмы" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Фильмы
    </a>
    <a href="series.html">
        <img src="ico/nav_mob/Сериалы.svg" alt="Сериалы" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Сериалы
    </a>
</nav>

<style>
.nav-tabs a.active img {
    filter: brightness(0) invert(0); /* делает иконку черной */
}
</style>

    </header>

    <main>
        <section id="hero" class="hero">
            <!-- Hero badge (number + gradient) positioned relative to .hero -->
            <div class="hero-badge" aria-hidden="true">
                <div class="hero-number">1</div>
            </div>
                <!-- hero glare element (следует за мышкой) -->
                <div class="glare-overlay hero-glare" aria-hidden="true"><div class="glare-light"></div></div>
            <div class="hero-content">
                <img id="hero-logo" class="hero-logo" alt="Логотип">
                <h1 id="hero-logo-text" class="hero-logo-text"></h1>
                <p id="hero-description"></p>
                <div class="hero-buttons">
                  <button id="hero-watch-btn" class="watch-btn">
  <img src="ico/Плей.svg" alt="watch icon" 
       style="width:20px;height:20px;object-fit:contain;margin-right:8px;filter:brightness(0);">
  Смотреть
</button>
                    <button id="hero-info-btn" class="info-btn">Подробнее</button>
                </div>
            </div>
        </section>

        <!-- Top 10 Carousels -->
        <!-- Top 10 Trends -->
        <div class="top10-container" id="top10-app" style="display: none;">
            <div class="container">
                <h2>Топ недели</h2>
                <div class="carousel-wrapper">
                    <div class="carousel">
                        <div class="carousel-track" id="carouselTrack"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="top10-loading" style="display: block; text-align: center; padding: 40px 20px; color: #999;">Загрузка...</div>

        <section class="category">
            <h2>Новые фильмы </h2>
            <div id="new-movies" class="movie-row"></div>
        </section>

        <!-- Top 10 Movies -->
        <div class="top10-container" id="top10-movies-app" style="display: none;">
            <div class="container">
                <h2>Топ фильмов</h2>
                <div class="carousel-wrapper">
                    <div class="carousel">
                        <div class="carousel-track" id="moviesCarouselTrack"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="top10-movies-loading" style="display: block; text-align: center; padding: 40px 20px; color: #999;">Загрузка...</div>

        <section class="category">
            <h2>Новые сериалы </h2>
            <div id="new-series" class="movie-row"></div>
        </section>

        <!-- Top 10 Series -->
        <div class="top10-container" id="top10-series-app" style="display: none;">
            <div class="container">
                <h2>Топ сериалов</h2>
                <div class="carousel-wrapper">
                    <div class="carousel">
                        <div class="carousel-track" id="seriesCarouselTrack"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="top10-series-loading" style="display: block; text-align: center; padding: 40px 20px; color: #999;">Загрузка...</div>

        <section class="category">
            <h2>Новые мультфильмы </h2>
            <div id="new-animations" class="movie-row"></div>
        </section>

        <section class="category">
            <h2>Легендарные фильмы </h2>
            <div id="legendary-movies" class="movie-row"></div>
        </section>

        <section class="category">
            <h2>Легендарные сериалы </h2>
            <div id="legendary-series" class="movie-row"></div>
        </section>
    </main>

    <!-- Модальные окна -->
    <div id="search-modal" class="modal mobile-search-modal">
        <div class="modal-content mobile-search-content">
            <button class="mobile-search-close" id="search-close">
                <img src="ico/закрыть.svg" alt="Закрыть" style="width: 24px; height: 24px;">
            </button>
            <div id="search-loader" class="search-loader" style="display:none;">
                <img src="ico/Загрузка.svg" alt="Загрузка" style="width:64px;height:64px;">
            </div>
            <div class="mobile-search-header">
                <h3>Поиск</h3>
            </div>
            <div id="search-empty" class="search-empty" style="display:none;">
                <img src="ico/Поискмд.png" alt="Поиск" style="width:96px;height:96px;margin-bottom:16px;">
                <p class="search-empty-text">Введите имя фильма, сериала или актера</p>
            </div>
            <form class="mobile-search-form" id="search-form">
                <input type="text" class="mobile-search-input" id="search-input" placeholder="Поиск фильмов, сериалов и актера...">
                <button type="submit" class="mobile-search-btn">
                    <img src="ico/nav_mob/Поиск.svg" alt="Поиск" style="width: 24px; height: 24px;">
                </button>
            </form>
            <div id="search-recent" class="search-recent" aria-hidden="true"></div>
            <div class="mobile-search-results">
                <div class="search-category">
                    <h2>Фильмы</h2>
                    <div id="search-movies" class="movie-row"></div>
                </div>
                <div class="search-category">
                    <h2>Сериалы</h2>
                    <div id="search-series" class="movie-row"></div>
                </div>
                <div class="search-category">
                    <h2>Актеры</h2>
                    <div id="search-actors" class="movie-row"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <a href="index.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="ico/nav_mob/Главная.svg" alt="Главная" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Главная</span>
        </a>
        <a href="movies.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="ico/nav_mob/Фильмы.svg" alt="Фильмы" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Фильмы</span>
        </a>
        <a href="series.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="ico/nav_mob/Сериалы.svg" alt="Сериалы" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Сериалы</span>
        </a>
        <a href="#" class="mobile-nav-item mobile-search-trigger">
            <span class="mobile-nav-icon">
                <img src="ico/nav_mob/Поиск.svg" alt="Поиск" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Поиск</span>
        </a>
    </nav>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <h2>Кино+</h2>
            <p class="tmdb-disclaimer">
                Этот продукт использует API TMDB, но не является официально поддерживаемым или сертифицированным TMDB.
Весь контент на сайте предоставляется исключительно в ознакомительных и развлекательных целях.
Все права на материалы принадлежат их законным правообладателям.
            </p>
        </div>
    </footer>

    <script>
        (function(){
            const API_KEY = '06936145fe8e20be28b02e26b55d3ce6';
            const BASE_URL = 'https://api.themoviedb.org/3';
            const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
            
            // Общая функция для создания карточек
            function createCards(content, forcedType = null) {
                return content.map((item, index) => {
                    const posterSrc = item.poster_path ? IMAGE_BASE + item.poster_path : 'https://via.placeholder.com/220x330/1a1a1a/666?text=No+Image';
                    const title = item.title || item.name || '';
                    // Используем принудительный тип для списков фильмов/сериалов или определяем из данных
                    const type = forcedType || item.media_type || (item.first_air_date ? 'tv' : 'movie');
                    return `
                        <div class="card top10-card" data-id="${item.id}" data-type="${type}" data-title="${title.replace(/"/g, '&quot;')}">
                            <div class="number">${index + 1}</div>
                            <div class="poster-container">
                                <img class="poster" src="${posterSrc}" alt="${title}">
                                <div class="glare-overlay">
                                    <div class="glare-light"></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Функция загрузки и отображения для каждой карусели
            async function fetchAndRenderContent(url, trackId, loadingId, containerId) {
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    const content = data.results.slice(0, 10);
                    
                    const track = document.getElementById(trackId);
                    if (track) {
                        track.innerHTML = createCards(content);
                    }
                    
                    document.getElementById(loadingId).style.display = 'none';
                    document.getElementById(containerId).style.display = 'block';
                } catch (error) {
                    console.error(`Ошибка загрузки контента для ${trackId}:`, error);
                    const ld = document.getElementById(loadingId);
                    if (ld) ld.innerHTML = 'Ошибка загрузки данных';
                }
            }

            // Загрузка трендов дня для hero
            async function fetchTrendingDay() {
                try {
                    const response = await fetch(`${BASE_URL}/trending/all/day?api_key=${API_KEY}&language=ru-RU`);
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        const hero = data.results[0];
                        document.getElementById('hero-logo-text').textContent = hero.title || hero.name;
                        document.getElementById('hero-description').textContent = hero.overview || '';
                    }
                } catch (error) {
                    console.error('Ошибка загрузки трендов дня:', error);
                }
            }

            // Загружаем все карусели
            fetchTrendingDay();
            
            // Top 10 общие тренды недели
            fetchAndRenderContent(
                `${BASE_URL}/trending/all/week?api_key=${API_KEY}&language=ru-RU`,
                'carouselTrack',
                'top10-loading',
                'top10-app'
            );

            // Top 10 фильмов
            async function fetchMoviesContent() {
                try {
                    const response = await fetch(`${BASE_URL}/movie/popular?api_key=${API_KEY}&language=ru-RU`);
                    const data = await response.json();
                    const content = data.results.slice(0, 10);
                    
                    const track = document.getElementById('moviesCarouselTrack');
                    if (track) {
                        track.innerHTML = createCards(content, 'movie'); // Принудительно указываем тип 'movie'
                    }
                    
                    document.getElementById('top10-movies-loading').style.display = 'none';
                    document.getElementById('top10-movies-app').style.display = 'block';
                } catch (error) {
                    console.error('Ошибка загрузки фильмов:', error);
                    const ld = document.getElementById('top10-movies-loading');
                    if (ld) ld.innerHTML = 'Ошибка загрузки данных';
                }
            }

            // Top 10 сериалов
            async function fetchSeriesContent() {
                try {
                    const response = await fetch(`${BASE_URL}/tv/popular?api_key=${API_KEY}&language=ru-RU`);
                    const data = await response.json();
                    const content = data.results.slice(0, 10);
                    
                    const track = document.getElementById('seriesCarouselTrack');
                    if (track) {
                        track.innerHTML = createCards(content, 'tv'); // Принудительно указываем тип 'tv'
                    }
                    
                    document.getElementById('top10-series-loading').style.display = 'none';
                    document.getElementById('top10-series-app').style.display = 'block';
                } catch (error) {
                    console.error('Ошибка загрузки сериалов:', error);
                    const ld = document.getElementById('top10-series-loading');
                    if (ld) ld.innerHTML = 'Ошибка загрузки данных';
                }
            }

            fetchMoviesContent();
            fetchSeriesContent();

            // Интерактивность карточек - следование за мышкой (плавная интерполяция)
            const maxRotation = 18;

            function lerp(a, b, t) { return a + (b - a) * t; }

            function ensureCardState(card) {
                if (card._target && card._current) return;
                card._target = { rx: 0, ry: 0, glareX: 0, glareY: 0, glareOpacity: 0 };
                card._current = { rx: 0, ry: 0, glareX: 0, glareY: 0, glareOpacity: 0 };
                const g = card.querySelector('.glare-light');
                const rect = card.getBoundingClientRect();
                if (g) {
                    card._current.glareX = rect.width / 2;
                    card._current.glareY = rect.height / 2;
                    card._target.glareX = card._current.glareX;
                    card._target.glareY = card._current.glareY;
                }
            }

            // Hero glare state helper
            const heroEl = document.querySelector('.hero');
            function ensureHeroState(hero) {
                if (!hero) return;
                if (hero._target && hero._current) return;
                hero._target = { glareX: 0, glareY: 0, glareOpacity: 0 };
                hero._current = { glareX: 0, glareY: 0, glareOpacity: 0 };
                const g = hero.querySelector('.glare-light');
                const rect = hero.getBoundingClientRect();
                if (g) {
                    hero._current.glareX = rect.width / 2;
                    hero._current.glareY = rect.height / 2;
                    hero._target.glareX = hero._current.glareX;
                    hero._target.glareY = hero._current.glareY;
                }
            }

            // Анимационный цикл: на каждом кадре перебираем все карточки (динамически)
            (function animate() {
                const ease = 0.18; // плавность поворота
                const glareEase = 0.22; // плавность блика

                document.querySelectorAll('.card').forEach(card => {
                    ensureCardState(card);
                    const g = card.querySelector('.glare-light');
                    const t = card._target;
                    const c = card._current;

                    c.rx = lerp(c.rx || 0, t.rx || 0, ease);
                    c.ry = lerp(c.ry || 0, t.ry || 0, ease);
                    c.glareX = lerp(c.glareX || 0, t.glareX || 0, glareEase);
                    c.glareY = lerp(c.glareY || 0, t.glareY || 0, glareEase);
                    c.glareOpacity = lerp(c.glareOpacity || 0, t.glareOpacity || 0, ease);

                    card.style.transform = `rotateX(${c.rx}deg) rotateY(${c.ry}deg)`;

                    if (g) {
                        g.style.left = `${c.glareX}px`;
                        g.style.top = `${c.glareY}px`;
                        g.style.opacity = `${c.glareOpacity}`;
                    }
                });

                // Обработка блика у hero (если есть)
                if (heroEl) {
                    ensureHeroState(heroEl);
                    const gH = heroEl.querySelector('.glare-light');
                    const tH = heroEl._target;
                    const cH = heroEl._current;

                    cH.glareX = lerp(cH.glareX || 0, tH.glareX || 0, glareEase);
                    cH.glareY = lerp(cH.glareY || 0, tH.glareY || 0, glareEase);
                    cH.glareOpacity = lerp(cH.glareOpacity || 0, tH.glareOpacity || 0, glareEase);

                    if (gH) {
                        gH.style.left = `${cH.glareX}px`;
                        gH.style.top = `${cH.glareY}px`;
                        gH.style.opacity = `${cH.glareOpacity}`;
                    }
                }

                requestAnimationFrame(animate);
            })();

            // Обновляем целевые значения при движении мыши
            document.addEventListener('mousemove', (e) => {
                document.querySelectorAll('.card').forEach(card => {
                    ensureCardState(card);
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const inside = x >= 0 && x <= rect.width && y >= 0 && y <= rect.height;

                    if (inside) {
                        const centerX = rect.width / 2;
                        const centerY = rect.height / 2;
                        const rotateX = ((y - centerY) / centerY) * -maxRotation;
                        const rotateY = ((x - centerX) / centerX) * maxRotation;

                        card._target.rx = rotateX;
                        card._target.ry = rotateY;

                        const glare = card.querySelector('.glare-light');
                        if (glare) {
                            card._target.glareX = Math.max(0, Math.min(rect.width, x));
                            card._target.glareY = Math.max(0, Math.min(rect.height, y));
                            card._target.glareOpacity = 1;
                        }

                        card._hover = true;
                    } else if (card._hover) {
                        card._hover = false;
                        card._target.rx = 0;
                        card._target.ry = 0;
                        card._target.glareOpacity = 0;
                    }
                });

                // обновление состояния для hero (блик следует за курсором внутри hero)
                if (heroEl) {
                    ensureHeroState(heroEl);
                    const rectH = heroEl.getBoundingClientRect();
                    const hx = e.clientX - rectH.left;
                    const hy = e.clientY - rectH.top;
                    const insideH = hx >= 0 && hx <= rectH.width && hy >= 0 && hy <= rectH.height;

                    if (insideH) {
                        heroEl._target.glareX = Math.max(0, Math.min(rectH.width, hx));
                        heroEl._target.glareY = Math.max(0, Math.min(rectH.height, hy));
                        heroEl._target.glareOpacity = 1;
                    } else {
                        heroEl._target.glareOpacity = 0;
                    }
                }
            });

            // Если курсор покинул окно — вернуть всё к нулю
            window.addEventListener('mouseout', (e) => {
                if (!e.relatedTarget && !e.toElement) {
                    document.querySelectorAll('.card').forEach(card => {
                        ensureCardState(card);
                        card._target.rx = 0;
                        card._target.ry = 0;
                        card._target.glareOpacity = 0;
                        card._hover = false;
                    });
                    if (heroEl) {
                        ensureHeroState(heroEl);
                        heroEl._target.glareOpacity = 0;
                    }
                }
            });
        })();
    </script>
    <script src="js/player.js"></script>
    <script src="js/main.js"></script>
</body>
</html>