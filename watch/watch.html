<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Смотреть</title>
  <meta name="color-scheme" content="dark" />

  <style>
    @font-face {
      font-family: 'buttonbold';
      src: url('../Font/TTFirsNeue-DemiBold.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'textbold';
      src: url('../Font/TTFirsNeue-Bold.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'text';
      src: url('../Font/TTFirsNeue-Light.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'textregular';
      src: url('../Font/TTFirsNeue-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    /* Запрет на выделение и копирование текста */
body {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

/* Запрет на перетаскивание изображений */
img {
  user-select: none;
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  pointer-events: none;
}

/* Если нужно оставить клики по изображениям, но запретить перетаскивание */
img {
  -webkit-user-drag: none;
  -khtml-user-drag: none;
  -moz-user-drag: none;
  -o-user-drag: none;
  user-drag: none;
}

/* Запрет контекстного меню (правой кнопки мыши) */
body {
  -webkit-touch-callout: none;
}

/* Дополнительная защита для poster изображений */
.poster-3d-image,
.episode-thumb img,
.logo,
#backgroundContainer {
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: none;
}


    :root{
      --bg:#000000;
      --text:#e6e6ea;
      --muted:#9aa0a6;
      --accent:#22c55e;
      --radius:20px;
      --shadow:0 10px 30px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box; margin:0; padding:0; font-family:'textregular', sans-serif;}
    html,body{height:100%}
    body{
      background:var(--bg);
      color:var(--text);
      line-height:1.6;
      overflow-x:hidden;
    }
    a{text-decoration:none; color:inherit; transition:.3s}
    img{display:block; max-width:100%}

    /* ---------- PRELOADER ---------- */
    .preloader{
      position:fixed;
      inset:0;
      background:var(--bg);
      z-index:9999;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:1;
      transition:opacity .5s ease;
    }
    .preloader.hidden{opacity:0; pointer-events:none}
    .loader-wrapper{position:relative; width:100px; height:50px; margin:auto; z-index:1;}
    .loader-wrapper .packman::before,
    .loader-wrapper .packman::after{
      content:'';
      position:absolute;
      width:50px;
      height:25px;
      background-color:#EFF107;
    }
    .loader-wrapper .packman::before{
      border-radius:100px 100px 0 0;
      transform:translate(-50%, -50%);
      animation:pac-top 0.5s linear infinite;
      transform-origin:center bottom;
    }
    .loader-wrapper .packman::after{
      border-radius:0 0 100px 100px;
      transform:translate(-50%, 50%);
      animation:pac-bot 0.5s linear infinite;
      transform-origin:center top;
    }
    @keyframes pac-top{
      0%{transform:translate(-50%, -50%) rotate(0)}
      50%{transform:translate(-50%, -50%) rotate(-30deg)}
      100%{transform:translate(-50%, -50%) rotate(0)}
    }
    @keyframes pac-bot{
      0%{transform:translate(-50%, 50%) rotate(0)}
      50%{transform:translate(-50%, 50%) rotate(30deg)}
      100%{transform:translate(-50%, 50%) rotate(0)}
    }
    .dots .dot{
      position:absolute;
      z-index:-1;
      top:8px;
      width:10px;
      height:10px;
      border-radius:50%;
      background:#fff;
    }
    .dots .dot:nth-child(1){left:90px; animation:dot-stage1 0.5s infinite}
    .dots .dot:nth-child(2){left:60px; animation:dot-stage1 0.5s infinite}
    .dots .dot:nth-child(3){left:30px; animation:dot-stage1 0.5s infinite}
    .dots .dot:nth-child(4){left:10px; animation:dot-stage2 0.5s infinite}
    @keyframes dot-stage1{
      0%{transform:translate(0,0)}
      100%{transform:translate(-24px,0)}
    }
    @keyframes dot-stage2{
      0%{transform:scale(1)}
      5%,100%{transform:scale(0)}
    }


    /* ---------- HERO ---------- */
    .fade-in{
      opacity:0; 
      transform:translateY(30px); 
      transition:all .8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .fade-in.visible{
      opacity:1; 
      transform:translateY(0);
    }

    .hero{
      position:relative;
      min-height:85vh;
      display:flex; 
      align-items:center;
      justify-content:flex-start;
      padding:40px 24px;
      background:#000;
      overflow:hidden;
    }
    @media (max-width: 480px) {
  .hero {
    min-height: 80vh;
    padding: 15px 12px;
  }
}
@media (max-width: 768px) {
  #backgroundContainer::before, .hero-trailer::after {
  background: linear-gradient(to top, #000 0%, rgba(0,0,0,0) 30%) !important;

  }
}

    #backgroundContainer{
      position:absolute;
      top:50%;
      right:0;
      width:150vh;
      height:0;
      padding-bottom:calc(150vh * 9 / 16);
      background-size:cover;
      background-position:center;
      z-index:0;
      transform:translateY(-50%) scale(1.3);
      opacity:0;
      animation:smoothZoomIn 2.5s cubic-bezier(0.25,0.46,0.45,0.94) .3s forwards;
      transition:opacity 1s ease;
    }
    #backgroundContainer.hide{opacity:0}
    @keyframes smoothZoomIn{
      0%{transform:translateY(-50%) scale(1.3); opacity:0}
      100%{transform:translateY(-50%) scale(1); opacity:1}
    }
    #backgroundContainer::before{
      content:'';
      position:absolute;
      inset:0;
      background:
        linear-gradient(to right,#000 0%,#000 5%,rgba(0,0,0,0.9) 12%,rgba(0,0,0,0.6) 25%,rgba(0,0,0,0.3) 40%,transparent 60%),
        linear-gradient(to bottom,#000 0%,rgba(0,0,0,0.7) 10%,transparent 25%,transparent 75%,rgba(0,0,0,0.7) 90%,#000 100%);
      pointer-events:none;
      z-index:1;
    }

    .hero-trailer{
      position:absolute;
      top:50%;
      right:0;
      width:150vh;
      height:0;
      padding-bottom:calc(150vh * 9 / 16);
      transform:translateY(-50%);
      z-index:1;
      opacity:0;
      pointer-events:none;
      transition:opacity .5s ease;
      overflow:hidden;
    }
    .hero-trailer.active{
      opacity:1;
      pointer-events:all;
    }
    .hero-trailer iframe{
      position:absolute;
      top:50%;
      left:50%;
      width:177.78%;
      height:177.78%;
      transform:translate(-50%,-50%);
      border:none;
      pointer-events:none;
    }
    .hero-trailer::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(to right,#000 0%,#000 5%,rgba(0,0,0,0.9) 12%,rgba(0,0,0,0.6) 25%,rgba(0,0,0,0.3) 40%,transparent 60%),
        linear-gradient(to bottom,#000 0%,rgba(0,0,0,0.7) 10%,transparent 25%,transparent 75%,rgba(0,0,0,0.7) 90%,#000 100%);
      pointer-events:none;
      z-index:2;
    }

    .trailer-controls{
      position:absolute;
      top:30px;
      left:30px;
      z-index:10;
      display:none;
      gap:10px;
      flex-direction:row;
      align-items:center;
      justify-content:center;
      pointer-events:all;
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .trailer-controls[style*="display: flex"]{
      opacity:1;
    }
    .trailer-controls button{
      background:rgba(32,32,32,0.35);
      border:1px solid #ffffff21;
      border-radius:50%;
      width:45px;
      height:45px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      backdrop-filter:blur(5px);
      padding:0;
      margin:0;
      flex-shrink:0;
      transition:transform 0.2s ease;
    }
    .trailer-controls button:active{
      transform:scale(0.95);
    }
    .trailer-controls button img{
      width:20px;
      height:20px;
      filter:brightness(0) invert(1);
    }

    .wrap{
      position:relative; 
      z-index:2; 
      max-width:1400px; 
      margin:auto; 
      width:100%;
      display:flex;
      justify-content:flex-start;
      align-items:center;
      padding-left:60px;
    }

    .hero-content{
      max-width:550px;
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:7px;
    }
    .hero-content .content-id{transition-delay:.2s}
    .hero-content #logoBox{transition-delay:.4s}
    .hero-content .tagline{transition-delay:.6s}
    .hero-content .info-row{transition-delay:.8s}
    .hero-content .actions{transition-delay:1s}

    .content-id{
      color:rgba(133,133,133,0.493); 
      font-size:20px; 
      font-family:'text', sans-serif;
      font-weight:100;
    }
    .logo{
      max-width:480px;
      filter:drop-shadow(0 6px 24px rgba(0,0,0,.8));
    }
    .logo-text {
  color: rgb(255, 255, 255);
  font-size: 35px;
  font-family: 'textbold', sans-serif;
}
    .logo-container,
    .logo-with-title{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }
    .russian-title{
      color:var(--text);
      font-size:32px;
      font-family:'textbold', sans-serif;
      text-shadow:0 4px 12px rgba(0,0,0,.6);
    }

    .tagline{
      color:var(--muted);
      font-size:16px;
      font-family:'text', sans-serif;
    }

    .info-row{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      justify-content:center;
      font-size:14px;
      font-family:'textregular', sans-serif;
    }
    .info-row span{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:4px 20px;
      border-radius:999px;
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(25px);
      color:var(--text);
      white-space:nowrap;
      flex-shrink:0;
      z-index:0;
    }
    .info-row span::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:-1;
    }
    #modal-rating{
      font-family:'buttonbold', sans-serif;
      min-width:46px;
      justify-content:center;
    }
    #modal-rating.high{
      background-color:rgba(40,167,69,0.85) !important;
    }
    #modal-rating.low{
      background-color:rgba(255,140,0,0.85) !important;
    }

    .actions{
      display:flex; 
      gap:14px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .btn{
      position:relative;
      background-color:#fff;
      color:#000;
      border:none;
      width:200px;
      height:40px;
      font-size:1rem;
      cursor:pointer;
      border-radius:25px;
      font-family:'buttonbold', sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:transform 0.2s ease;
    }
    .btn:active{
      transform:scale(0.97);
    }
    .btn img{
      width:20px;
      height:20px;
      filter:invert(1);
    }

    .close-btn{
      position:fixed;
      top:10px;
      right:24px;
      cursor:pointer;
      background-color:rgba(0, 0, 0, 0.637);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px;
      z-index:1001;
      width:43px;
      height:43px;
      transition:transform 0.2s ease;
      pointer-events:auto;
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
    }
    .close-btn:active{
      transform:scale(0.95);
    }

    /* ---------- НИЖНИЙ БЛОК ---------- */

    .details{
      max-width:1200px;
      margin:40px auto;
      padding:0 24px;
      display:flex;
      flex-direction:column;
      gap:24px;
    }

    .card{
      padding:22px;
    }
    .card h2{
      margin-bottom:14px;
      font-size:22px;
      font-family:'textbold', sans-serif;
    }

    /* СЕЗОНЫ */
    .seasons-wrap{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:18px;
    }
    .seasons-title{
      font-size:18px;
      font-family:'textbold', sans-serif;
      white-space:nowrap;
    }
    .seasons-bar{
      display:flex;
      gap:10px;
      overflow-x:auto;
      padding-bottom:10px;
    }
    .seasons-bar::-webkit-scrollbar{
      height:6px;
    }
    .seasons-bar::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.2);
      border-radius:999px;
    }
    .season-pill{
      width:50px;
      height:50px;
      border-radius:50%;
      font-size:14px;
      background:rgba(94, 94, 94, .18);
      border:none;
      cursor:pointer;
      position:relative;
      color:var(--muted);
      transition:outline 0.3s ease, transform 0.2s ease;
      white-space:nowrap;
      font-family:'textregular', sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
      overflow:hidden;
      flex-shrink:0;
    }
    .season-pill::after{
      content:"";
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:radial-gradient(101.06% 100% at 50% 100%, rgb(94 94 94 / 23%) 0%, rgba(94, 94, 94, 0) 73.85%), radial-gradient(100% 100% at 50% 100%, hsla(0, 0%, 100%, 0.07) 0%, hsla(0, 0%, 100%, 0) 55.59%);
      opacity:0;
      transition:opacity 0.3s ease;
      border-radius:50%;
    }
    .season-pill:hover{
      outline:0px solid #666;
      outline-offset:10px;
    }
    .season-pill:hover::after{
      opacity:1;
    }
    .season-pill:active{
      transform:scale(0.95);
    }
    .season-pill.active{
      color:#fff;
      font-family:'buttonbold', sans-serif;
      background:linear-gradient(135deg, rgba(34, 197, 94, 0.9) 0%, rgba(34, 197, 94, 0.5) 100%);
    }
    .season-pill.active::after{
      display:none;
    }

    /* СЕРИИ (с градиентами по бокам) */
    .episodes-wrapper{
      position:relative;
      margin:0 -24px;
      padding:0 24px;
      min-height:280px;
    }
    .episodes-wrapper::before,
    .episodes-wrapper::after{
      content:"";
      position:absolute;
      top:0;
      bottom:10px;
      width:100px;
      pointer-events:none;
      z-index:2;
    }
    .episodes-wrapper::before{
      left:20px;
      background:linear-gradient(to right, rgba(0,0,0,1) 0%, rgba(0,0,0,0.8) 30%, transparent 100%);
      opacity:0;
      transition:opacity 0.3s ease;
      pointer-events:none;
    }
    .episodes-wrapper.scrolled::before{
      opacity:1;
    }
    .episodes-wrapper::after{
      right:20px;
      background:linear-gradient(to left, rgba(0,0,0,1) 0%, rgba(0,0,0,0.8) 30%, transparent 100%);
    }
    .episodes-grid{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding:10px 25px 10px;
      scroll-behavior:smooth;
      opacity:1;
      transition:opacity 0.3s ease;
      min-height:260px;
    }
    .episodes-grid.loading{
      opacity:0.4;
      pointer-events:none;
    }
    .episodes-grid::-webkit-scrollbar{
      height:6px;
    }
    .episodes-grid::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.2);
      border-radius:999px;
    }
    .episode-card{
      cursor:pointer;
      display:flex;
      flex-direction:column;
      gap:8px;
      transition:.2s ease;
      min-width:220px;
      max-width:220px;
      flex-shrink:0;
      opacity:0;
      transform:translateY(10px);
      animation:episodeFadeIn 0.4s ease forwards;
    }
    @keyframes episodeFadeIn{
      to{
        opacity:1;
        transform:translateY(0);
      }
    }
    .episode-card:nth-child(1){animation-delay:0.05s}
    .episode-card:nth-child(2){animation-delay:0.1s}
    .episode-card:nth-child(3){animation-delay:0.15s}
    .episode-card:nth-child(4){animation-delay:0.2s}
    .episode-card:nth-child(5){animation-delay:0.25s}
    .episode-card:nth-child(6){animation-delay:0.3s}
    .episode-card:nth-child(7){animation-delay:0.35s}
    .episode-card:nth-child(8){animation-delay:0.4s}
    .episode-card:nth-child(9){animation-delay:0.45s}
    .episode-card:nth-child(10){animation-delay:0.5s}
    
    .episode-card:hover .episode-thumb{
      transform:scale(1.015);
    }
    .episode-thumb{
      position:relative;
      width:100%;
      aspect-ratio:16/9;
      border-radius:16px;
      overflow:visible;
      background:transparent;
      transition:transform 0.25s ease;
      z-index:0;
    }
    .episode-thumb.shrink{
      transform:scale(0.97);
    }
    .episode-thumb-wrapper{
      position:relative;
      width:100%;
      height:100%;
      border-radius:16px;
      overflow:hidden;
      background:#111;
    }
    .episode-thumb-wrapper::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:1;
    }
    .episode-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .episode-runtime-badge{
      position:absolute;
      bottom:8px;
      right:8px;
      z-index:2;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:4px 12px;
      border-radius:999px;
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(25px);
      color:var(--text);
      white-space:nowrap;
      font-size:12px;
      font-family:'textregular', sans-serif;
    }
    .episode-runtime-badge::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:-1;
    }
    .episode-info{
      text-align:left;
      min-height:60px;
    }
    .episode-title{
      font-size:14px;
      font-family:'buttonbold', sans-serif;
      margin-bottom:4px;
      line-height:1.3;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .episode-meta{
      font-size:12px;
      color:var(--muted);
      font-family:'text', sans-serif;
    }

    /* ВКЛАДКИ */
    .info-tabs{
      margin-top:24px;
    }
    .info-tabs-nav{
      display:flex;
      flex-wrap:nowrap;
      gap:10px;
      margin-bottom:14px;
      overflow-x:auto;
      padding-bottom:10px;
    }
    .info-tabs-nav::-webkit-scrollbar{
      height:6px;
    }
    .info-tabs-nav::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.2);
      border-radius:999px;
    }
    .info-tab-btn{
      background:transparent;
      border:none;
      color:var(--muted);
      font-family:'buttonbold', sans-serif;
      padding:8px 14px 12px;
      border-radius:999px;
      cursor:pointer;
      transition:.25s;
      font-size:14px;
      position:relative;
      flex-shrink:0;
    }
    .info-tab-btn.active{
      color:#fff;
    }
    .info-tab-btn.active::after{
      content:"";
      position:absolute;
      left:10px;
      right:10px;
      bottom:0;
      height:2px;
      border-radius:999px;
      background:var(--accent);
    }
    .info-tabs-content{
      position:relative;
      overflow:hidden;
      max-height:2000px;
      transition:max-height 0.3s ease;
    }
    .info-tab-panel{
      position:static;
      width:100%;
      font-size:14px;
      color:var(--text);
      font-family:'text', sans-serif;
      opacity:0;
      pointer-events:none;
      max-height:0;
      transition:opacity 0.3s ease, max-height 0.3s ease;
      overflow:hidden;
    }
    .info-tab-panel.active{
      opacity:1;
      pointer-events:all;
      max-height:2000px;
      transition:opacity 0.3s ease, max-height 0.3s ease;
    }
    .info-tab-panel.active > * {
      animation:slideUpStagger 0.5s ease forwards;
    }
    .info-tab-panel.active > *:nth-child(1) { animation-delay:0.05s; }
    .info-tab-panel.active > *:nth-child(2) { animation-delay:0.1s; }
    .info-tab-panel.active > *:nth-child(3) { animation-delay:0.15s; }
    .info-tab-panel.active > *:nth-child(4) { animation-delay:0.2s; }
    .info-tab-panel.active > *:nth-child(5) { animation-delay:0.25s; }
    .info-tab-panel.active > *:nth-child(6) { animation-delay:0.3s; }

    /* Трейлеры */
    .trailers-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
      gap:20px;
      margin-top:10px;
      padding:5px;
      overflow:visible;
    }
    @media (max-width: 768px) {
      .trailers-grid{
        grid-template-columns:1fr;
        padding:5px 10px;
        gap:16px;
      }
      .trailer-card:hover .trailer-thumb{
        transform:none;
      }
      .trailer-info{
        padding:12px 0;
      }
    }
    .trailer-card{
      background:transparent;
      transition:.3s;
      cursor:pointer;
      position:relative;
      overflow:visible;
    }
    .trailer-card:hover .trailer-thumb{
      transform:scale(1.015);
    }
    .trailer-thumb{
      position:relative;
      width:100%;
      padding-bottom:56.25%;
      border-radius:16px;
      overflow:visible;
      background:transparent;
      transition:transform 0.25s ease;
      z-index:0;
    }
    .trailer-thumb::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:1;
    }
    .trailer-thumb img{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      object-fit:cover;
      pointer-events:all;
      border-radius:16px;
    }
    .trailer-play-icon{
      position:absolute;
      bottom:8px;
      left:8px;
      z-index:2;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px;
      border-radius:50%;
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(25px);
      pointer-events:all;
      cursor:pointer;
    }
    .trailer-play-icon::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(255,255,255,0.05)
      );
      -webkit-mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
    }
    .trailer-play-icon img{
      width:24px;
      height:24px;
      position:relative;
      z-index:1;
    }
    .trailer-info{
      padding:15px;
      color:var(--text);
      font-family:'text', sans-serif;
      font-size:14px;
      line-height:1.6;
      text-align:left;
    }
    .trailer-name{
      font-family:'textbold', sans-serif;
      font-size:16px;
      margin-bottom:8px;
      color:#fff;
    }
    .info-tab-panel.active > *:nth-child(7) { animation-delay:0.35s; }
    .info-tab-panel.active > *:nth-child(8) { animation-delay:0.4s; }
    .info-tab-panel.active > *:nth-child(9) { animation-delay:0.45s; }
    .info-tab-panel.active > *:nth-child(n+10) { animation-delay:0.5s; }
    
    @keyframes slideUpStagger {
      from {
        opacity:0;
        transform:translateY(20px);
      }
      to {
        opacity:1;
        transform:translateY(0);
      }
    }
    .info-warning{
      margin-top:14px;
      font-size:12px;
      color:var(--muted);
      font-family:'text', sans-serif;
    }
    .info-meta-list{
      display:grid;
      grid-template-columns:1fr;
      gap:12px 20px;
      margin-top:8px;
      font-size:14px;
    }
    @media(min-width:769px){
      .info-meta-list{
        grid-template-columns:1fr 1fr;
      }
      .trailer-controls{
        position:absolute !important;
        bottom:30px !important;
        right:30px !important;
        top:auto !important;
        left:auto !important;
        margin-top:0 !important;
        transform:none !important;
      }
    }
    .info-meta-row{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .info-meta-row-label{
      font-size:12px;
      color:var(--muted);
      font-family:'buttonbold', sans-serif;
      text-transform:uppercase;
    }
    .info-meta-label{
      display:none !important;
    }
    .info-meta-value{
      font-family:'textregular', sans-serif;
    }
    .info-meta-value a{
      color:var(--accent);
    }

    /* 3D ПОСТЕР В ОПИСАНИИ */
    .description-with-poster{
      display:flex;
      gap:20px;
      align-items:flex-start;
    }
    .poster-3d-scene{
      width:200px;
      height:300px;
      perspective:1200px;
      flex-shrink:0;
    }
    .poster-3d-card{
      width:100%;
      height:100%;
      position:relative;
      transform-style:preserve-3d;
      border-radius:12px;
      box-shadow:0 20px 50px rgba(0,0,0,0.5);
      cursor:pointer;
      background:#000;
    }
    .poster-3d-card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:10;
    }
    .poster-3d-image{
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:12px;
      display:block;
      pointer-events:none;
      transform:translateZ(0);
    }
    .poster-glare-overlay{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      border-radius:12px;
      overflow:hidden;
      z-index:10;
      pointer-events:none;
      mix-blend-mode:overlay;
      transform:translateZ(1px);
    }
    .poster-glare-light{
      position:absolute;
      width:300px;
      height:300px;
      background:radial-gradient(
        circle,
        rgba(255,255,255,0.8) 0%,
        rgba(255,255,255,0.4) 30%,
        rgba(255,255,255,0) 70%
      );
      transform:translate(-50%,-50%);
      opacity:0;
      filter:blur(15px);
    }
    .description-text{
      flex:1;
      font-size:14px;
      line-height:1.6;
      font-family:'text', sans-serif;
    }

    /* СЪЁМОЧНАЯ ГРУППА */
    .crew-section{
      display:flex;
      flex-direction:column;
      gap:20px;
    }
    .crew-role{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .crew-label{
      font-size:12px;
      color:var(--muted);
      font-family:'buttonbold', sans-serif;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    .crew-names{
      font-size:14px;
      font-family:'textregular', sans-serif;
      display:flex;
      flex-wrap:nowrap;
      gap:16px;
      overflow-x:auto;
      padding-bottom:10px;
    }
    .crew-names::-webkit-scrollbar{
      height:6px;
    }
    .crew-names::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,0.2);
      border-radius:999px;
    }
    .crew-member{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      text-align:center;
      color:inherit;
      cursor:pointer;
      flex-shrink:0;
    }
    .crew-avatar{
      width:90px;
      height:90px;
      border-radius:50%;
      overflow:hidden;
      background:rgba(255,255,255,0.1);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      position:relative;
      z-index:0;
    }
    .crew-avatar::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      padding:1px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,0.35),
        rgba(200,200,200,0.15),
        rgba(255,255,255,0.25),
        rgba(120,120,120,0.1)
      );
      -webkit-mask: 
        linear-gradient(#fff 0 0) content-box, 
        linear-gradient(#fff 0 0);
      -webkit-mask-composite:xor;
      mask-composite:exclude;
      pointer-events:none;
      z-index:-1;
    }
    .crew-avatar img{
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .crew-member-info{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .crew-member-name{
      font-size:13px;
      color:#fff;
      text-decoration:none;
      transition:color 0.3s ease;
    }
    .crew-member-name:hover{
      color:var(--accent);
    }
    .crew-member-role{
      font-size:11px;
      color:var(--muted);
      margin-top:0px;
    }
    .crew-link-icon{
      width:20px;
      height:20px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      transition:transform 0.3s ease;
    }
    .crew-link-icon img{
      width:100%;
      height:100%;
      object-fit:contain;
      filter:brightness(0) invert(1);
    }
    .crew-member:hover .crew-link-icon{
      transform:rotate(-45deg) translateY(-2px);
    }

    /* ---------- МОДАЛ СЕРИИ ---------- */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
      backdrop-filter:blur(8px);
    }
    .modal-backdrop.active{display:flex;}
    .episode-modal{
      background:#0a0a0a;
      border-radius:20px;
      max-width:620px;
      width:100%;
      overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,0.9);
      border:1px solid rgba(255,255,255,0.1);
      position:relative;
    }
    .episode-modal-close{
      position:absolute;
      top:12px;
      right:12px;
      width:36px;
      height:36px;
      border-radius:50%;
      border:1px solid rgba(255,255,255,0.2);
      background:#181818;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10;
    }
    .episode-modal-close img{
      width:18px;
      height:18px;
      filter:brightness(0) invert(1);
    }
    .episode-modal-header{
      padding:20px 20px 12px;
    }
    .episode-modal-title{
      font-size:20px;
      font-family:'textbold', sans-serif;
      margin-bottom:8px;
      padding-right:50px;
    }
    .episode-modal-thumb{
      width:100%;
      aspect-ratio:16/9;
      overflow:visible;
      background:transparent;
      padding:0 20px;
      margin-bottom:16px;
    }
    .episode-modal-thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      border-radius:15px;
    }
    .episode-modal-body{
      padding:0 20px 20px;
    }
    .episode-modal-overview{
      font-size:14px;
      line-height:1.6;
      margin-bottom:12px;
      color:var(--text);
      font-family:'text', sans-serif;
    }
    .episode-modal-meta{
      font-size:13px;
      color:var(--muted);
      font-family:'text', sans-serif;
    }

    /* ---------- FOOTER ---------- */
    .footer{
      text-align:center;
      padding:24px;
      color:rgba(200,200,200,0.4);
      font-size:12px;
      border-top:1px solid rgba(255,255,255,.08);
      margin-top:40px;
      font-family:'text', sans-serif;
    }
    @media (max-width: 768px) {
      .footer{
        padding-bottom:120px;
      }
    }

    /* ---------- MOBILE ---------- */
    @media(max-width:768px){
      .hero{
        min-height:70vh;
        padding:20px 16px;
        justify-content:flex-end;
        align-items:flex-end;
      }
      .wrap{
        padding-left:0;
        justify-content:center;
      }
      .trailer-controls{
        top:30px !important;
        left:30px !important;
        bottom:auto !important;
        right:auto !important;
      }
      #backgroundContainer{
        width:177.78vw;
        height:0;
        padding-bottom:100vw;
        right:auto;
        left:50%;
        top:0;
        transform:translateX(-50%) scale(1.3);
        animation:smoothZoomInMobile 2.5s cubic-bezier(0.25,0.46,0.45,0.94) .3s forwards;
      }
      .hero-trailer{
        width:177.78vw;
        height:0;
        padding-bottom:100vw;
        right:auto;
        left:50%;
        top:0;
        transform:translateX(-50%);
      }
      .hero-trailer iframe{
        width:177.78%;
        height:177.78%;
      }
      @keyframes smoothZoomInMobile{
        0%{transform:translateX(-50%) scale(1.3); opacity:0}
        100%{transform:translateX(-50%) scale(1); opacity:1}
      }
      #backgroundContainer::before,
      .hero-trailer::after{
        background:linear-gradient(to bottom,rgba(0,0,0,0.2) 0%,rgba(0,0,0,0.5) 40%,rgba(0,0,0,0.8) 70%,#000 100%);
      }
      .hero-content{
        max-width:100%;
        align-items:center;
        text-align:center;
        margin-top:170px;
      }
      .content-id{font-size:16px}
      .logo{max-width:250px}
      .russian-title{font-size:24px}
      .info-row{
        font-size:12px;
        gap:8px;
      }
      .info-row span{padding:4px 12px}
      .details{
        padding:0 16px;
        margin:24px auto;
      }
      .episodes-wrapper{
        margin:0 -16px;
        padding:0 16px;
      }
      .episodes-wrapper::before{
        left:0;
      }
      .episodes-wrapper::after{
        right:0;
      }
      .episodes-grid{
        padding:10px 0 10px;
      }
      .seasons-wrap{
        flex-direction:column;
        align-items:center;
        text-align:center;
      }
      .seasons-bar{
        width:100%;
        padding:0 0 10px 0;
      }
      .description-with-poster{
        flex-direction:column;
      }
      .poster-3d-scene{
        width:150px;
        height:225px;
        margin:0 auto;
      }
    }

    @media(max-width:480px){
      .hero{
        min-height:65vh;
        padding:15px 12px;
      }
      .logo{max-width:230px}
      .russian-title{font-size:22px}
      .info-row{font-size:11px}
      .info-row span{padding:3px 10px}
      .actions{
        flex-direction:column;
        width:100%;
      }
      .btn{width:100%}
      .episode-card{
        min-width:180px;
        max-width:180px;
      }
    }

    /* PAC-MAN LOADING ANIMATION */
    .loader-wrapper {
      position: relative;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      margin: auto;
    }

    .loader-wrapper .packman::before {
      content: '';
      position: absolute;
      width: 50px;
      height: 25px;
      background-color: #EFF107;
      border-radius: 100px 100px 0 0;
      transform: translate(-50%, -50%);
      animation: pac-top 0.5s linear infinite;
      transform-origin: center bottom;
    }

    .loader-wrapper .packman::after {
      content: '';
      position: absolute;
      width: 50px;
      height: 25px;
      background-color: #EFF107;
      border-radius: 0 0 100px 100px;
      transform: translate(-50%, 50%);
      animation: pac-bot 0.5s linear infinite;
      transform-origin: center top;
    }

    @keyframes pac-top {
      0% {
        transform: translate(-50%, -50%) rotate(0)
      }
      50% {
        transform: translate(-50%, -50%) rotate(-30deg)
      }
      100% {
        transform: translate(-50%, -50%) rotate(0)
      }
    }

    @keyframes pac-bot {
      0% {
        transform: translate(-50%, 50%) rotate(0)
      }
      50% {
        transform: translate(-50%, 50%) rotate(30deg)
      }
      100% {
        transform: translate(-50%, 50%) rotate(0)
      }
    }

    .dots .dot {
      position: absolute;
      z-index: -1;
      top: 8px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fff;
    }

    .dots .dot:nth-child(1) {
      left: 90px;
      animation: dot-stage1 0.5s infinite;
    }

    .dots .dot:nth-child(2) {
      left: 60px;
      animation: dot-stage1 0.5s infinite;
    }

    .dots .dot:nth-child(3) {
      left: 30px;
      animation: dot-stage1 0.5s infinite;
    }

    .dots .dot:nth-child(4) {
      left: 10px;
      animation: dot-stage2 0.5s infinite;
    }

    @keyframes dot-stage1 {
      0% {
        transform: translate(0, 0);
      }
      100% {
        transform: translate(-24px, 0);
      }
    }

    @keyframes dot-stage2 {
      0% {
        transform: scale(1);
      }
      5%, 100% {
        transform: scale(0);
      }
    }

    /* Header Styles */
    .header {
        width: 100%;
        padding: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        z-index: 100;
        gap: 10px;
        overflow: hidden;
    }

    .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 50px;
        pointer-events: none;
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));
        -webkit-mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0));
    }

    /* Navigation Tabs */
    .nav-tabs {
        display: flex;
        gap: 20px;
        position: relative;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        align-items: center;
        font-family: 'buttonbold', sans-serif;
        background: rgba(0, 0, 0, 0.637);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 25px;
        padding: 5px 5px;
        border: none;
        z-index: 0;
    }

    .nav-tabs::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1px;
        background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.35),
            rgba(200, 200, 200, 0.15),
            rgba(255, 255, 255, 0.25),
            rgba(120, 120, 120, 0.1)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: add, add;
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        pointer-events: none;
        z-index: -1;
    }

    .nav-tabs a {
        color: white;
        text-decoration: none;
        font-size: 1rem;
        font-weight: 500;
        transition: color 0.3s ease, transform 0.2s ease;
        display: inline-flex;
        align-items: center;
        height: 20px;
        line-height: 1;
        padding: 7px 7px;
    }

    .nav-tabs a:hover {
        color: #e0e0e0;
        transform: scale(1.05);
    }

    .nav-tabs a:active {
        transform: scale(0.94);
    }

    .nav-tabs a.active {
        position: relative;
        isolation: isolate;
        padding: 17px 12px;
        border-radius: 28px;
        z-index: 1;
        background: none;
        border: none;
        color: #fff;
        color: black !important;
        background-color: rgb(255, 255, 255);
    }

    /* Mobile Navigation */
    .mobile-nav {
        display: none;
        position: fixed;
        bottom: 0px;
        left: 0px;
        right: 0px;
        z-index: 1000;
        border: none;
        border-top: 1px solid #ffffff0c;
        background: none;
        padding: 0;
        margin: 0;
        isolation: isolate;
        align-items: center;
        justify-content: space-around;
        overflow: hidden;
        backdrop-filter: blur(15px);
        background-color: #141414ea;
    }

    @media (max-width: 768px) {
        .mobile-nav {
            display: flex;
        }
    }

    .mobile-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: #ffffff;
        transition: all 0.3s ease, transform 0.2s ease;
        padding: 6px 8px;
        border-radius: 12px;
        margin: 0 4px;
        min-width: 50px;
    }

    .mobile-nav-item:hover {
        transform: scale(1.05);
    }

    .mobile-nav-item:active {
        transform: scale(0.94);
    }

    .mobile-nav-item.active {
        color: #2196f3;
        background: radial-gradient(circle at center, rgba(33, 149, 243, 0.26) 0%, rgba(33, 150, 243, 0) 70%);
    }

    .mobile-nav-icon {
        font-size: 1.5rem;
    }

    .mobile-nav-text {
        font-size: 0.7rem;
        font-family: 'buttonbold', sans-serif;
        font-weight: 500;
    }

    .mobile-nav::before,
    .mobile-nav::after {
        pointer-events: none;
    }

    @media (max-width: 768px) {
        .header {
            display: none;
        }
    }
  </style>

  <script src="../js/player.js"></script>
</head>
<body>
    <header class="header">
        <nav class="nav-tabs">
    <a href="../index.html">
        <img src="../ico/nav_mob/Главная.svg" alt="Главная" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Главная
    </a>
    <a href="../movies.html">
        <img src="../ico/nav_mob/Фильмы.svg" alt="Фильмы" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Фильмы
    </a>
    <a href="../series.html">
        <img src="../ico/nav_mob/Сериалы.svg" alt="Сериалы" style="width:20px; height:20px; margin-right:8px; object-fit:contain;">
        Сериалы
    </a>
</nav>

<style>
.nav-tabs a.active img {
    filter: brightness(0) invert(0); /* делает иконку черной */
}
</style>

    </header>

  <div class="preloader" id="preloader">
    <div class="loader-wrapper">
      <div class="packman"></div>
      <div class="dots">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>
  </div>

  <button class="close-btn" aria-label="Закрыть" title="Закрыть">
    <img src="../ico/закрыть.svg" alt="Закрыть" style="width:24px;height:24px;">
  </button>

  <header class="hero" id="hero">
    <div id="backgroundContainer"></div>
    <div class="hero-trailer" id="trailerContainer"></div>

    <div class="trailer-controls" id="trailerControls">
      <button id="trailer-sound-btn">
        <img src="../ico/Звук_выкл.png" alt="Звук">
      </button>
      <button id="trailer-exit-btn">
        <img src="../ico/закрыть.svg" alt="Закрыть">
      </button>
    </div>

    <div class="wrap">
      <div class="hero-content">
        <div class="content-id fade-in" id="contentId"></div>
        <div id="logoBox" class="fade-in"></div>
        <p class="tagline fade-in" id="tagline"></p>

        <div class="info-row fade-in" id="infoRow">
          <span id="modal-year"></span>
          <span id="modal-seasons" style="display:none;"></span>
          <span id="modal-age-rating" class="age-rating" style="display:none;"></span>
          <span id="modal-rating" class="rating" style="display:none;"></span>
        </div>

        <div class="actions fade-in">
          <button id="watchLink" class="btn">
            <img alt="Смотреть" id="watchIcon" src="../ico/Плей.svg">
            <span>Смотреть</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="details">
    <div id="loadingSkeletons">
      <div class="card skeleton-card"></div>
      <div class="card skeleton-card"></div>
    </div>

    <div id="actualContent" style="display:none">
      <!-- СЕЗОНЫ + СЕРИИ -->
      <section class="card" id="seasonsBlock" style="display:none;">
        <div class="seasons-wrap">
          <div class="seasons-title">Сезоны и серии</div>
          <div class="seasons-bar" id="seasonsBar"></div>
        </div>
        <div class="episodes-wrapper">
          <div class="episodes-grid" id="episodesGrid"></div>
        </div>
      </section>

      <!-- ВКЛАДКИ -->
      <section class="card info-tabs">
        <div class="info-tabs-nav">
          <button class="info-tab-btn active" data-tab="desc">Описание</button>
          <button class="info-tab-btn" data-tab="about">О проекте</button>
          <button class="info-tab-btn" data-tab="crew">Съёмочная группа</button>
          <button class="info-tab-btn" data-tab="trailers">Трейлеры и другое</button>
        </div>

        <div class="info-tabs-content">
          <div class="info-tab-panel active" id="tab-desc">
            <div class="description-with-poster">
              <div class="poster-3d-scene" id="posterScene">
                <div class="poster-3d-card" id="posterCard">
                  <img src="" alt="Постер" class="poster-3d-image" id="poster3dImage">
                  <div class="poster-glare-overlay">
                    <div class="poster-glare-light" id="posterGlare"></div>
                  </div>
                </div>
              </div>
              <div class="description-text" id="mainOverview"></div>
            </div>
            <p class="info-warning">
              Контент может содержать сцены курения и употребления спиртных напитков. Курение и чрезмерное употребление алкоголя вредит здоровью.
            </p>
          </div>

          <div class="info-tab-panel" id="tab-about">
            <div class="info-meta-list" id="aboutList"></div>
          </div>

          <div class="info-tab-panel" id="tab-crew">
            <div class="crew-section" id="crewSection"></div>
          </div>

          <div class="info-tab-panel" id="tab-trailers">
            <div class="trailers-grid" id="trailersGrid"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    Контент на сайте представлен в чисто развлекательных целях. Мы не несем ответственности за содержание и не призываем к нарушению авторских прав.
  </footer>

  <!-- МОДАЛ СЕРИИ -->
  <div class="modal-backdrop" id="episodeModalBackdrop">
    <div class="episode-modal" id="episodeModal">
      <button class="episode-modal-close" id="episodeModalClose">
        <img src="../ico/закрыть.svg" alt="Закрыть">
      </button>
      <div class="episode-modal-header">
        <div class="episode-modal-title" id="episodeModalTitle"></div>
      </div>
      <div class="episode-modal-thumb" id="episodeModalThumb"></div>
      <div class="episode-modal-body">
        <div class="episode-modal-overview" id="episodeModalOverview"></div>
        <div class="episode-modal-meta" id="episodeModalMeta"></div>
      </div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // ИСПРАВЛЕНИЕ: Полностью очищаем блокировку скролла при загрузке страницы watch
    (function() {
      // Убираем все стили фиксации с body
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.left = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      document.body.style.height = '';
      document.body.style.margin = '';
      document.body.style.padding = '';
      
      // Убираем overflow с html
      document.documentElement.style.overflow = '';
      
      // Убираем все классы блокировки скролла
      document.body.classList.remove('no-scroll');
      document.body.classList.remove('loading');
      document.documentElement.classList.remove('no-scroll');
      
      // Восстанавливаем скролл позицию если она была сохранена
      const savedScrollY = parseInt(document.body.dataset.scrollY || '0', 10);
      if (savedScrollY > 0) {
        setTimeout(() => {
          window.scrollTo(0, savedScrollY);
        }, 100);
      }
      
      // Очищаем сохраненные данные о скролле
      try {
        delete document.body.dataset.scrollY;
      } catch (e) {
        document.body.removeAttribute('data-scroll-y');
      }
    })();

    // Установка активного пункта меню на основе источника открытия
    function setActiveNavItemFromSource() {
      const watchSource = sessionStorage.getItem('watchSource') || 'index.html';
      
      // Для навигации в header
      const navLinks = document.querySelectorAll('.nav-tabs a');
      navLinks.forEach(link => {
        const href = link.getAttribute('href');
        // Сравниваем с относительными путями
        const isActive = href === '../' + watchSource || 
                        (href === '../index.html' && (watchSource === 'index.html' || watchSource === '')) ||
                        href === '../' + watchSource;
        
        if (isActive) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });
      
      // Для мобильной навигации
      const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
      mobileNavItems.forEach(item => {
        const href = item.getAttribute('href');
        const isActive = href === '../' + watchSource || 
                        (href === '../index.html' && (watchSource === 'index.html' || watchSource === '')) ||
                        href === '../' + watchSource;
        
        if (isActive) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }
    
    // Вызов функции при загрузке
    setActiveNavItemFromSource();

    // Читаем параметры из URL
    const urlParams = new URLSearchParams(window.location.search);
    const urlTV_ID = urlParams.get('TV_ID') || '';
    const urlM_ID = urlParams.get('M_ID') || '';
    const urlAutoplay = urlParams.get('autoplay') === '1';
    
    console.log('[INIT] URL параметры: TV_ID=' + urlTV_ID + ', M_ID=' + urlM_ID + ', autoplay=' + urlAutoplay);
    
    // Используем параметры из URL, если они есть, иначе значения по умолчанию
    const API_KEY='06936145fe8e20be28b02e26b55d3ce6';
    const TV_ID = urlTV_ID || '';
    const M_ID = urlM_ID || '';
    const API='https://api.themoviedb.org/3';
    const IMG=(p,s='original')=>p?`https://image.tmdb.org/t/p/${s}${p}`:'';

    const $=s=>document.querySelector(s);
    const backgroundContainer=$('#backgroundContainer');
    const trailerContainer=$('#trailerContainer');
    const trailerControls=$('#trailerControls');
    const logoBox=$('#logoBox');
    const isTV = TV_ID && !M_ID;
    const contentType = isTV ? 'tv' : 'movie';
    const contentId = isTV ? TV_ID : M_ID;
    
    console.log('[INIT] contentId=' + contentId + ', contentType=' + contentType);

    let player;
    let isMuted = true;
    let trailerTimeout;
    let shouldAutoplay = urlAutoplay;
    let progressInterval;
    let allTrailers = [];
    let showData = null;
    let activeSeason = 1;

    // 3D Постер
    const posterCard = $('#posterCard');
    const posterGlare = $('#posterGlare');
    const posterScene = $('#posterScene');
    const maxRotation = 12;

    function init3DPoster(){
      posterScene.addEventListener('mousemove', (e) => {
        const rect = posterCard.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;

        const rotateX = ((y - centerY) / centerY) * -maxRotation; 
        const rotateY = ((x - centerX) / centerX) * maxRotation;

        posterCard.style.transition = 'none';
        posterCard.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;

        posterGlare.style.left = `${x}px`;
        posterGlare.style.top = `${y}px`;
        posterGlare.style.opacity = '1';
      });

      posterScene.addEventListener('mouseleave', () => {
        posterCard.style.transition = 'transform 0.5s ease-out';
        posterCard.style.transform = `rotateX(0deg) rotateY(0deg)`;
        posterGlare.style.opacity = '0';
      });
    }

    // Функция анимации "сжатия" постеров серий
    function animateEpisodeThumbsBack() {
      const thumbs = document.querySelectorAll('.episode-thumb');
      thumbs.forEach(thumb => {
        thumb.classList.add('shrink');
      });

      setTimeout(() => {
        thumbs.forEach(thumb => {
          thumb.classList.remove('shrink');
        });
      }, 250);
    }

    function hidePreloader(){
      const preloader=$('#preloader');
      preloader.classList.add('hidden');
      setTimeout(()=>preloader.remove(),500);
    }

    function showContent(){
      $('#loadingSkeletons').style.display='none';
      $('#actualContent').style.display='block';
      setTimeout(()=>{
        document.querySelectorAll('.details .fade-in').forEach(el=>el.classList.add('visible'));
      },100);
    }

    function createLogoWithTitle(data,logo){
      const title=isTV?data.name:data.title;
      if(logo){
        if(logo.iso_639_1==='ru'){
          return `<img class="logo" src="${IMG(logo.file_path,'w500')}" alt="Логотип">`;
        }else{
          return `<div class="logo-with-title">
                    <img class="logo" src="${IMG(logo.file_path,'w500')}" alt="Логотип">
                    <div class="russian-title">${title}</div>
                  </div>`;
        }
      }else{
        return `<div class="logo-text">${title}</div>`;
      }
    }

    async function getTrailers(){
      try{
        // Делаем два запроса: один для всех языков, второй специально для русских
        const [response1, response2] = await Promise.all([
          fetch(`${API}/${contentType}/${contentId}/videos?api_key=${API_KEY}`),
          fetch(`${API}/${contentType}/${contentId}/videos?api_key=${API_KEY}&language=ru-RU`)
        ]);
        const data1 = await response1.json();
        const data2 = await response2.json();
        
        // Объединяем результаты и удаляем дубликаты по key
        const allVideos = [...data1.results, ...data2.results];
        const uniqueVideos = Array.from(new Map(allVideos.map(v => [v.key, v])).values());
        
        const trailers = uniqueVideos.filter(v=>v.type==='Trailer' && v.site==='YouTube');
        trailers.sort((a,b)=>{
          const lp={ru:0,en:1};
          const pa=lp[a.iso_639_1] ?? 2;
          const pb=lp[b.iso_639_1] ?? 2;
          return pa-pb;
        });
        return trailers;
      }catch(e){return [];}
    }

    // Отдельная функция для получения только официальных английских трейлеров для фона
    async function getOfficialTrailers(){
      try{
        const response = await fetch(`${API}/${contentType}/${contentId}/videos?api_key=${API_KEY}`);
        const data = await response.json();
        const trailers = data.results.filter(v=>
          v.type==='Trailer' && 
          v.site==='YouTube' &&
          (v.iso_639_1 === 'en' || !v.iso_639_1)
        );
        // Сортировка: официальные первыми
        trailers.sort((a,b)=>{
          const aOfficial = a.official || a.name.toLowerCase().includes('official');
          const bOfficial = b.official || b.name.toLowerCase().includes('official');
          if(aOfficial && !bOfficial) return -1;
          if(!aOfficial && bOfficial) return 1;
          return 0;
        });
        return trailers;
      }catch(e){return [];}
    }

    function testTrailerQuick(trailer){
      return new Promise(resolve=>{
        const testDiv=document.createElement('div');
        testDiv.style.display='none';
        document.body.appendChild(testDiv);
        let resolved=false;
        const timeout=setTimeout(()=>{
          if(!resolved){
            resolved=true;
            try{testPlayer?.destroy();}catch(e){}
            if(document.body.contains(testDiv)) document.body.removeChild(testDiv);
            resolve(false);
          }
        },3000);
        let testPlayer;
        try{
          testPlayer=new YT.Player(testDiv,{
            videoId:trailer.key,
            playerVars:{autoplay:1,mute:1,controls:0,fs:0},
            events:{
              onReady:(e)=>{
                setTimeout(()=>{
                  try{
                    const t=e.target.getCurrentTime();
                    if(t>0 && !resolved){
                      resolved=true;
                      clearTimeout(timeout);
                      e.target.destroy();
                      if(document.body.contains(testDiv)) document.body.removeChild(testDiv);
                      resolve(true);
                    }
                  }catch(err){}
                },1000);
              },
              onError:()=>{
                if(!resolved){
                  resolved=true;
                  clearTimeout(timeout);
                  try{testPlayer.destroy();}catch(err){}
                  if(document.body.contains(testDiv)) document.body.removeChild(testDiv);
                  resolve(false);
                }
              }
            }
          });
        }catch(err){
          if(!resolved){
            resolved=true;
            clearTimeout(timeout);
            if(document.body.contains(testDiv)) document.body.removeChild(testDiv);
            resolve(false);
          }
        }
      });
    }

    async function findWorkingTrailer(trailersToTest = allTrailers){
      for(const t of trailersToTest){
        const ok=await testTrailerQuick(t);
        if(ok) return t;
      }
      return null;
    }

    function playTrailer(videoKey){
      const playerDiv=document.createElement('div');
      playerDiv.id='youtube-player';
      trailerContainer.innerHTML='';
      trailerContainer.appendChild(playerDiv);

      player=new YT.Player('youtube-player',{
        videoId:videoKey,
        playerVars:{
          autoplay:1,
          mute:1,
          controls:0,
          disablekb:1,
          fs:0,
          modestbranding:1,
          rel:0,
          showinfo:0,
          iv_load_policy:3,
          playsinline:1,
          enablejsapi:1
        },
        events:{
          onReady:onPlayerReady,
          onStateChange:onPlayerStateChange,
          onError:onPlayerError
        }
      });
    }

    function onPlayerReady(e){
      e.target.playVideo();
      e.target.mute();
      backgroundContainer.classList.add('hide');
      trailerContainer.classList.add('active');
      trailerControls.style.display='flex';
      setTimeout(() => {
        trailerControls.style.opacity='1';
      }, 10);
      startProgressMonitoring(e.target);
    }

    function startProgressMonitoring(p){
      if(progressInterval) clearInterval(progressInterval);
      progressInterval=setInterval(()=>{
        if(p?.getDuration && p?.getCurrentTime){
          try{
            const d=p.getDuration();
            const c=p.getCurrentTime();
            const left=d-c;
            if(left<=10.5){
              clearInterval(progressInterval);
              stopTrailer();
            }
          }catch(e){}
        }
      },100);
    }

    function onPlayerStateChange(e){
      if(e.data===YT.PlayerState.ENDED) stopTrailer();
    }

    function onPlayerError(){
      stopTrailer();
    }

    function stopTrailer(){
      if(progressInterval) clearInterval(progressInterval);
      trailerControls.style.opacity='0';
      setTimeout(() => {
        if(player){
          player.destroy();
          player=null;
        }
        trailerContainer.classList.remove('active');
        trailerControls.style.display='none';
        backgroundContainer.classList.remove('hide');
        trailerContainer.innerHTML='';
      }, 300);
    }

    $('#trailer-sound-btn').addEventListener('click',()=>{
      if(!player) return;
      if(isMuted){
        player.unMute();
        player.setVolume(100);
        $('#trailer-sound-btn img').src='../ico/Звук_вкл.png';
      }else{
        player.mute();
        $('#trailer-sound-btn img').src='../ico/Звук_выкл.png';
      }
      isMuted=!isMuted;
    });

    $('#trailer-exit-btn').addEventListener('click',()=>{
      stopTrailer();
      if(trailerTimeout) clearTimeout(trailerTimeout);
      animateEpisodeThumbsBack();
    });

    // Клик по кнопке "Смотреть"
    document.getElementById('watchLink')?.addEventListener('click', () => {
      animateEpisodeThumbsBack();
      if(player){
        stopTrailer();
        if(trailerTimeout) clearTimeout(trailerTimeout);
      }
      const id=contentId.replace(/^(film|tv)\//,'');
      if(window.multiPlayer){
        window.multiPlayer.playContent(id,contentType);
      }
    });

    // Клик по общей Close-кнопке
    document.querySelector('.close-btn')?.addEventListener('click', () => {
      animateEpisodeThumbsBack();
      // Полностью очищаем все стили блокировки перед возвратом
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.left = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      document.body.style.height = '';
      document.body.style.margin = '';
      document.body.style.padding = '';
      document.documentElement.style.overflow = '';
      document.body.classList.remove('no-scroll');
      document.body.classList.remove('loading');
      document.documentElement.classList.remove('no-scroll');
      
      // Восстанавливаем скролл
      const savedScrollY = parseInt(document.body.dataset.scrollY || '0', 10);
      try {
        delete document.body.dataset.scrollY;
      } catch (e) {
        document.body.removeAttribute('data-scroll-y');
      }
      
      // Возврат назад в истории браузера
      setTimeout(() => {
        window.history.back();
      }, 300);
    });

    // Делегирование клика по episode-thumb-wrapper
    document.addEventListener('click', (e) => {
      const wrapper = e.target.closest('.episode-thumb-wrapper');
      if (!wrapper) return;

      const thumb = wrapper.closest('.episode-thumb');
      if (!thumb) return;

      thumb.classList.add('shrink');
      setTimeout(() => {
        thumb.classList.remove('shrink');
      }, 250);
    });

    async function loadEpisodesForSeason(seasonNumber){
      if(!isTV || !showData) return;
      activeSeason = seasonNumber;

      document.querySelectorAll('.season-pill').forEach(el=>{
        el.classList.toggle('active', Number(el.dataset.season)===seasonNumber);
      });

      const episodesGrid = $('#episodesGrid');
      
      episodesGrid.classList.add('loading');
      
      setTimeout(async()=>{
        episodesGrid.innerHTML = 'Загрузка серий...';

        try{
          const res = await fetch(`${API}/tv/${TV_ID}/season/${seasonNumber}?api_key=${API_KEY}&language=ru-RU`);
          const seasonData = await res.json();
          const episodes = seasonData.episodes || [];

          if(!episodes.length){
            episodesGrid.innerHTML = '<div style="color:var(--muted);font-size:14px;">Серии не найдены</div>';
            episodesGrid.classList.remove('loading');
            return;
          }

          episodesGrid.innerHTML = '';
          episodes.forEach(ep=>{
            const card = document.createElement('div');
            card.className = 'episode-card';
            card.dataset.episodeNumber = ep.episode_number;
            card.dataset.seasonNumber = seasonNumber;

            const still = ep.still_path || showData.backdrop_path || showData.poster_path;
            const runtimeBadge = ep.runtime ? `<span class="episode-runtime-badge">${ep.runtime} мин</span>` : '';

            card.innerHTML = `
              <div class="episode-thumb">
                <div class="episode-thumb-wrapper">
                  ${still ? `<img src="${IMG(still,'w300')}" alt="${ep.name}">` : ''}
                  ${runtimeBadge}
                </div>
              </div>
              <div class="episode-info">
                <div class="episode-title">${ep.episode_number}. ${ep.name || 'Без названия'}</div>
                <div class="episode-meta">
                  ${ep.air_date ? new Date(ep.air_date).toLocaleDateString('ru-RU') : ''}
                </div>
              </div>
            `;
            card.addEventListener('click', ()=>openEpisodeModal(ep, seasonNumber, still));
            episodesGrid.appendChild(card);
          });

          episodesGrid.classList.remove('loading');

        }catch(e){
          episodesGrid.innerHTML = '<div style="color:var(--muted);font-size:14px;">Ошибка загрузки серий</div>';
          episodesGrid.classList.remove('loading');
        }
      }, 200);
    }

    function openEpisodeModal(ep, seasonNumber, still){
      $('#episodeModalTitle').textContent = `${seasonNumber} сезон, ${ep.episode_number} серия — ${ep.name || ''}`;
      
      const thumbEl = $('#episodeModalThumb');
      if(still){
        thumbEl.innerHTML = `<img src="${IMG(still,'w500')}" alt="${ep.name}">`;
      }else{
        thumbEl.innerHTML = '';
      }

      $('#episodeModalOverview').textContent = ep.overview || 'Описание серии отсутствует.';

      let metaParts = [];
      if(ep.air_date) metaParts.push(new Date(ep.air_date).toLocaleDateString('ru-RU'));
      if(ep.runtime) metaParts.push(ep.runtime + ' мин');
      $('#episodeModalMeta').textContent = metaParts.join(' · ');

      $('#episodeModalBackdrop').classList.add('active');
    }

    $('#episodeModalClose').addEventListener('click',()=>{
      $('#episodeModalBackdrop').classList.remove('active');
      // Убедимся что скролл страницы не заблокирован
      document.body.style.overflow = '';
      document.documentElement.style.overflow = '';
    });
    $('#episodeModalBackdrop').addEventListener('click',e=>{
      if(e.target.id === 'episodeModalBackdrop'){
        $('#episodeModalBackdrop').classList.remove('active');
        // Убедимся что скролл страницы не заблокирован
        document.body.style.overflow = '';
        document.documentElement.style.overflow = '';
      }
    });

    document.addEventListener('click',e=>{
      const btn = e.target.closest('.info-tab-btn');
      if(!btn) return;
      document.querySelectorAll('.info-tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      document.querySelectorAll('.info-tab-panel').forEach(p=>p.classList.remove('active'));
      
      setTimeout(()=>{
        $('#tab-'+tab).classList.add('active');
        if(tab === 'trailers'){
          loadTrailersTab();
        }
      }, 50);
    });

    // Функция загрузки трейлеров для вкладки
    let trailersLoaded = false;
    async function loadTrailersTab(){
      if(trailersLoaded) return;
      trailersLoaded = true;
      
      const trailersGrid = $('#trailersGrid');
      trailersGrid.innerHTML = '<p style="color:var(--muted);text-align:center;padding:20px;">Загрузка трейлеров...</p>';
      
      try{
        const trailers = await getTrailers();
        
        if(trailers.length === 0){
          trailersGrid.innerHTML = '<p style="color:var(--muted);text-align:center;padding:20px;">Трейлеры не найдены</p>';
          return;
        }
        
        // Берем первые 5 трейлеров (уже отсортированы по языку в getTrailers: ru первые)
        const first5 = trailers.slice(0, 5);
        
        trailersGrid.innerHTML = '';
        
        for(const trailer of first5){
          const card = document.createElement('div');
          card.className = 'trailer-card';
          
          // Получаем thumbnail от YouTube
          const thumbUrl = `https://img.youtube.com/vi/${trailer.key}/hqdefault.jpg`;
          
          card.innerHTML = `
            <div class="trailer-thumb">
              <img src="${thumbUrl}" alt="${trailer.name}">
              <span class="episode-runtime-badge">${trailer.iso_639_1?.toUpperCase() || 'EN'}</span>
              <div class="trailer-play-icon">
                <img src="../ico/Плей.svg" alt="Play">
              </div>
            </div>
            <div class="trailer-info">
              <div class="trailer-name">${trailer.name}</div>
            </div>
          `;
          
          card.addEventListener('click', ()=>{
            window.open(`https://www.youtube.com/watch?v=${trailer.key}`, '_blank');
          });
          
          trailersGrid.appendChild(card);
        }
      }catch(err){
        console.error('Ошибка загрузки трейлеров:', err);
        trailersGrid.innerHTML = '<p style="color:var(--muted);text-align:center;padding:20px;">Ошибка загрузки трейлеров</p>';
      }
    }

    async function load(){
      try{
        console.log('[LOAD] Начало загрузки. contentType=' + contentType + ', contentId=' + contentId);
        
        const append=isTV
          ? 'credits,content_ratings,images,videos,external_ids'
          : 'credits,releases,images,videos,external_ids';
        const res=await fetch(`${API}/${contentType}/${contentId}?api_key=${API_KEY}&language=ru-RU&append_to_response=${append}&include_image_language=ru,null,en`);
        const d=await res.json();
        showData = d;

        // Обновляем title страницы
        const title = isTV ? d.name : d.title;
        document.title = `Смотреть ${title}`;
        
        console.log('[LOAD] Загрузка успешна. Title=' + title);

        $('#contentId').textContent=isTV?`tv/${TV_ID}`:`film/${M_ID}`;

        let bg='';
        if(d.backdrop_path) bg=d.backdrop_path;
        else if(d.images?.backdrops?.length) bg=d.images.backdrops[0].file_path;
        else if(d.poster_path) bg=d.poster_path;
        if(bg) backgroundContainer.style.backgroundImage=`url(${IMG(bg)})`;

        // Постер для 3D
        if(d.poster_path){
          $('#poster3dImage').src = IMG(d.poster_path,'w500');
        }

        const logos=d.images?.logos||[];
        const ruLogo=logos.find(l=>l.iso_639_1==='ru');
        const enLogo=logos.find(l=>l.iso_639_1==='en');
        const anyLogo=logos[0];
        const selectedLogo=ruLogo||enLogo||anyLogo;
        logoBox.innerHTML=createLogoWithTitle(d,selectedLogo);

        const releaseDate=isTV?d.first_air_date:d.release_date;
        const year=(releaseDate||'').slice(0,4);
        const seasons=isTV?d.number_of_seasons:null;

        let age='';
        if(isTV){
          age=(d.content_ratings?.results||[]).find(x=>x.iso_3166_1==='RU')?.rating||'';
        }else{
          age=(d.releases?.countries||[]).find(x=>x.iso_3166_1==='RU')?.certification||'';
        }
        const voteAvg=(d.vote_average||0).toFixed(1);
        const ratingVal=parseFloat(voteAvg);

        $('#tagline').textContent=d.tagline||'';

        const yearEl=$('#modal-year');
        const seasonsEl=$('#modal-seasons');
        const ageEl=$('#modal-age-rating');
        const ratingEl=$('#modal-rating');

        if(year){
          yearEl.textContent=year;
          yearEl.style.display='inline-flex';
        }else{
          yearEl.style.display='none';
        }

        if(isTV && seasons && seasons>0){
          seasonsEl.textContent=`${seasons} сезон(ов)`;
          seasonsEl.style.display='inline-flex';
        }else if(!isTV && d.runtime){
          const h=Math.floor(d.runtime/60);
          const m=d.runtime%60;
          seasonsEl.textContent=`${h}ч ${m}м`;
          seasonsEl.style.display='inline-flex';
        }else{
          seasonsEl.style.display='none';
        }

        if(age && age!=='N/A'){
          ageEl.textContent=age;
          ageEl.style.display='inline-flex';
        }else{
          ageEl.style.display='none';
        }

        if(ratingVal>0){
          ratingEl.textContent=voteAvg;
          ratingEl.style.display='inline-flex';
          ratingEl.classList.remove('high','low');
          if(ratingVal>=7.0) ratingEl.classList.add('high');
          else ratingEl.classList.add('low');
        }else{
          ratingEl.style.display='none';
        }

        $('#mainOverview').textContent = d.overview || 'Описание отсутствует';

        const aboutList = $('#aboutList');
        aboutList.innerHTML = '';

        const genres = (d.genres||[]).map(g=>g.name).join(', ');
        const originCountries = (d.origin_country||[]).join(', ') || (d.production_countries||[]).map(c=>c.name).join(', ');
        const originalTitle=isTV?d.original_name:d.original_title;
        const worldDate = d.first_air_date || d.release_date;

        if(genres){
          const row=document.createElement('div');
          row.className='info-meta-row';
          row.innerHTML=`<div class="info-meta-row-label">Жанры</div><div class="info-meta-value">${genres}</div>`;
          aboutList.appendChild(row);
        }
        if(originCountries){
          const row=document.createElement('div');
          row.className='info-meta-row';
          row.innerHTML=`<div class="info-meta-row-label">Страны</div><div class="info-meta-value">${originCountries}</div>`;
          aboutList.appendChild(row);
        }
        if(originalTitle){
          const row=document.createElement('div');
          row.className='info-meta-row';
          row.innerHTML=`<div class="info-meta-row-label">Оригинальное название</div><div class="info-meta-value">${originalTitle}</div>`;
          aboutList.appendChild(row);
        }
        if(worldDate){
          const row=document.createElement('div');
          row.className='info-meta-row';
          row.innerHTML=`<div class="info-meta-row-label">Премьера в мире</div><div class="info-meta-value">${new Date(worldDate).toLocaleDateString('ru-RU')}</div>`;
          aboutList.appendChild(row);
        }

        const crewSection = $('#crewSection');
        crewSection.innerHTML='';

        const crew = d.credits?.crew || [];
        const cast = d.credits?.cast || [];

        const directors = crew.filter(c=>c.job==='Director');
        if(directors.length>0){
          const div=document.createElement('div');
          div.className='crew-role';
          const namesHTML = directors.map(p=>`
            <a href="./actor.html?ID=${p.id}" class="crew-member" style="text-decoration:none;">
              <div class="crew-avatar">
                ${p.profile_path ? `<img src="${IMG(p.profile_path, 'w185')}" alt="${p.name}">` : '<div style="font-size:10px;color:var(--muted);">Нет фото</div>'}
              </div>
              <div class="crew-member-info">
                <span class="crew-member-name">${p.name}</span>
                <span class="crew-link-icon"><img src="../ico/Перейти.svg" alt="Перейти"></span>
              </div>
            </a>
          `).join('');
          div.innerHTML=`<div class="crew-label">Режиссер</div><div class="crew-names">${namesHTML}</div>`;
          crewSection.appendChild(div);
        }

        if(cast.length>0){
          const div=document.createElement('div');
          div.className='crew-role';
          const namesHTML = cast.slice(0,10).map(p=>`
            <a href="./actor.html?ID=${p.id}" class="crew-member" style="text-decoration:none;">
              <div class="crew-avatar">
                ${p.profile_path ? `<img src="${IMG(p.profile_path, 'w185')}" alt="${p.name}">` : '<div style="font-size:10px;color:var(--muted);">Нет фото</div>'}
              </div>
              <div class="crew-member-info">
                <span class="crew-member-name">${p.name}</span>
                <span class="crew-link-icon"><img src="../ico/Перейти.svg" alt="Перейти"></span>
              </div>
              ${p.character ? `<div class="crew-member-role">${p.character}</div>` : ''}
            </a>
          `).join('');
          div.innerHTML=`<div class="crew-label">В главных ролях</div><div class="crew-names">${namesHTML}</div>`;
          crewSection.appendChild(div);
        }

        const writers = crew.filter(c=>c.job==='Screenplay' || c.job==='Writer');
        if(writers.length>0){
          const div=document.createElement('div');
          div.className='crew-role';
          const namesHTML = writers.map(p=>`
            <a href="./actor.html?ID=${p.id}" class="crew-member" style="text-decoration:none;">
              <div class="crew-avatar">
                ${p.profile_path ? `<img src="${IMG(p.profile_path, 'w185')}" alt="${p.name}">` : '<div style="font-size:10px;color:var(--muted);">Нет фото</div>'}
              </div>
              <div class="crew-member-info">
                <span class="crew-member-name">${p.name}</span>
                <span class="crew-link-icon"><img src="../ico/Перейти.svg" alt="Перейти"></span>
              </div>
            </a>
          `).join('');
          div.innerHTML=`<div class="crew-label">Сценаристы</div><div class="crew-names">${namesHTML}</div>`;
          crewSection.appendChild(div);
        }

        const producers = crew.filter(c=>c.job==='Producer');
        if(producers.length>0){
          const div=document.createElement('div');
          div.className='crew-role';
          const namesHTML = producers.slice(0,5).map(p=>`
            <a href="./actor.html?ID=${p.id}" class="crew-member" style="text-decoration:none;">
              <div class="crew-avatar">
                ${p.profile_path ? `<img src="${IMG(p.profile_path, 'w185')}" alt="${p.name}">` : '<div style="font-size:10px;color:var(--muted);">Нет фото</div>'}
              </div>
              <div class="crew-member-info">
                <span class="crew-member-name">${p.name}</span>
                <span class="crew-link-icon"><img src="../ico/Перейти.svg" alt="Перейти"></span>
              </div>
            </a>
          `).join('');
          div.innerHTML=`<div class="crew-label">Продюсер</div><div class="crew-names">${namesHTML}</div>`;
          crewSection.appendChild(div);
        }

        if(isTV && d.number_of_seasons>0){
          $('#seasonsBlock').style.display='block';
          const seasonsBar = $('#seasonsBar');
          seasonsBar.innerHTML='';
          for(let i=1;i<=d.number_of_seasons;i++){
            const pill=document.createElement('div');
            pill.className='season-pill' + (i===1?' active':'');
            pill.textContent=`${i}`;
            pill.dataset.season=i;
            pill.addEventListener('click',()=>loadEpisodesForSeason(i));
            seasonsBar.appendChild(pill);
          }
          loadEpisodesForSeason(1);
        }

        init3DPoster();

        setTimeout(()=>{
          hidePreloader();
          showContent();
          setTimeout(()=>{
            document.querySelectorAll('.hero-content .fade-in').forEach(el=>el.classList.add('visible'));
          },100);

          // Если параметр autoplay=1, автоматически запускаем плеер
          if(shouldAutoplay){
            console.log('[AUTOPLAY] Параметр autoplay найден. contentId:', contentId, 'contentType:', contentType);
            const id=contentId.replace(/^(film|tv)\//,'');
            console.log('[AUTOPLAY] Очищенный ID:', id);
            
            // Ждем инициализации multiPlayer
            let retries = 0;
            const autoplayInterval = setInterval(()=>{
              retries++;
              console.log('[AUTOPLAY] Попытка', retries, 'window.multiPlayer доступен:', !!window.multiPlayer);
              
              if(window.multiPlayer && id){
                clearInterval(autoplayInterval);
                console.log('[AUTOPLAY] Запускаем плеер с ID:', id, 'Type:', contentType);
                window.multiPlayer.playContent(id, contentType);
              } else if(retries > 50) {
                // После 50 попыток (5 секунд) останавливаемся
                clearInterval(autoplayInterval);
                console.error('[AUTOPLAY] Не удалось инициализировать multiPlayer');
              }
            }, 100);
          } else {
            // Иначе загружаем трейлер через 10 секунд
            trailerTimeout=setTimeout(async()=>{
              allTrailers=await getTrailers();
              // Для фона получаем только английские официальные трейлеры
              const officialTrailers = await getOfficialTrailers();
              if(officialTrailers.length>0){
                const working=await findWorkingTrailer(officialTrailers);
                if(working) playTrailer(working.key);
              }
            },10000);
          }
        },800);

      }catch(err){
        console.error('Ошибка загрузки:',err);
        setTimeout(()=>{
          hidePreloader();
          showContent();
        },800);
      }
    }

    console.log('[MAIN] Вызов load(). shouldAutoplay=' + shouldAutoplay);
    load();

    // Отслеживание прокрутки episodes-grid
    const episodesGrid = $('#episodesGrid');
    const episodesWrapper = episodesGrid?.parentElement;
    if(episodesGrid && episodesWrapper){
      episodesGrid.addEventListener('scroll', () => {
        if(episodesGrid.scrollLeft > 0){
          episodesWrapper.classList.add('scrolled');
        } else {
          episodesWrapper.classList.remove('scrolled');
        }
      });
    }

  </script>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <a href="../index.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="../ico/nav_mob/Главная.svg" alt="Главная" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Главная</span>
        </a>
        <a href="../movies.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="../ico/nav_mob/Фильмы.svg" alt="Фильмы" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Фильмы</span>
        </a>
        <a href="../series.html" class="mobile-nav-item">
            <span class="mobile-nav-icon">
                <img src="../ico/nav_mob/Сериалы.svg" alt="Сериалы" style="width: 24px; height: 24px;">
            </span>
            <span class="mobile-nav-text">Сериалы</span>
        </a>
    </nav>
</body>
</html>
